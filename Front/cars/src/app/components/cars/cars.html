<div class="cars-container">
  <header class="cars-header">
    <div class="header-content">
      <h1>Mis Carros</h1>
      
      <!-- Desktop Menu -->
      <div class="desktop-menu">
        <button class="btn btn-back" (click)="goBack()">
          ‚Üê Volver al Dashboard
        </button>
        <button class="btn btn-primary" (click)="showAddCarForm()">
          + Agregar Carro
        </button>
      </div>
      
      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" (click)="toggleMobileMenu()" [class.active]="isMobileMenuOpen">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    
    <!-- Mobile Menu -->
    <div class="mobile-menu" [class.open]="isMobileMenuOpen">
      <div class="mobile-menu-content">
        <div class="mobile-menu-actions">
          <button class="btn btn-back" (click)="goBack(); closeMobileMenu()">
            ‚Üê Volver al Dashboard
          </button>
          <button class="btn btn-primary" (click)="showAddCarForm(); closeMobileMenu()">
            + Agregar Carro
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="cars-main">
    <!-- Indicador de carga -->
    <div class="loading-card" *ngIf="isLoading">
      <div class="spinner"></div>
      <h3>Cargando carros...</h3>
    </div>

    <!-- Mensaje de error -->
    <div class="error-card" *ngIf="errorMessage && !isLoading">
      <h3>‚ö†Ô∏è Error</h3>
      <p>{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="loadCars()">Reintentar</button>
    </div>

    <!-- Filtros y b√∫squeda -->
    <div class="filters-card" *ngIf="!isLoading && !errorMessage">
      <div class="filters-row">
        <div class="search-box">
          <input 
            type="text" 
            [(ngModel)]="searchQuery" 
            (input)="searchCars()"
            placeholder="Buscar por n√∫mero de placa o modelo..."
            class="search-input">
        </div>
        
        <div class="filter-group">
          <select [(ngModel)]="selectedYear" (change)="filterByYear()" class="filter-select">
            <option value="">Todos los a√±os</option>
            <option *ngFor="let year of years" [value]="year">{{ year }}</option>
          </select>
        </div>
        
        <div class="filter-group">
          <select [(ngModel)]="selectedBrand" (change)="filterByBrand()" class="filter-select">
            <option value="">Todas las marcas</option>
            <option *ngFor="let brand of brands" [value]="brand">{{ brand }}</option>
          </select>
        </div>
        
        <button class="btn btn-secondary" (click)="clearFilters()">
          Limpiar Filtros
        </button>
      </div>
    </div>

    <!-- Vista Kanban de carros -->
    <div class="kanban-container" *ngIf="!isLoading && !errorMessage">
      <div class="kanban-column" *ngFor="let car of filteredCars; trackBy: trackByCarId">
        <div class="car-card">
          <div class="car-image">
            <img 
              *ngIf="car.photoUrl" 
              [src]="car.photoUrl" 
              [alt]="car.brand + ' ' + car.model"
              class="car-photo">
            <div *ngIf="!car.photoUrl" class="no-photo">
              <span>üì∑</span>
              <p>Sin foto</p>
            </div>
          </div>
          
          <div class="car-info">
            <div class="car-details">
              <div class="detail-item">
                <span class="label">Marca:</span>
                <span class="value">{{ car.brand }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Modelo:</span>
                <span class="value">{{ car.model }}</span>
              </div>
              <div class="detail-item">
                <span class="label">A√±o:</span>
                <span class="value">{{ car.year }}</span>
              </div>
              <div class="detail-item">
                <span class="label">N√∫mero de Placa:</span>
                <span class="value">{{ car.licensePlate }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Color:</span>
                <span class="value">{{ car.color }}</span>
              </div>
            </div>
          </div>
          
          <div class="car-actions">
            <button class="btn btn-edit" (click)="editCar(car)">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn btn-delete" (click)="deleteCar(car)">
              üóëÔ∏è Eliminar
            </button>
          </div>
        </div>
      </div>
      
      <!-- Mensaje cuando no hay carros -->
      <div class="no-cars" *ngIf="filteredCars.length === 0">
        <div class="no-cars-content">
          <span class="no-cars-icon">üöó</span>
          <h3>No hay carros</h3>
          <p>Agrega tu primer carro para comenzar</p>
          <button class="btn btn-primary" (click)="showAddCarForm()">
            + Agregar Carro
          </button>
        </div>
      </div>
    </div>

    <!-- Modal para agregar/editar carro -->
    <div class="modal-overlay" *ngIf="showAddForm" (click)="cancelForm()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ editingCar ? 'Editar Carro' : 'Agregar Nuevo Carro' }}</h2>
          <button class="btn-close" (click)="cancelForm()">√ó</button>
        </div>
        
        <div class="modal-body">
          <form (ngSubmit)="saveCar()" #carFormRef="ngForm">
            <div class="form-row">
              <div class="form-group">
                <label>Marca *</label>
                <select [(ngModel)]="carForm.brand" name="brand" required class="form-input">
                  <option value="">Seleccionar marca</option>
                  <option *ngFor="let brand of brands" [value]="brand">{{ brand }}</option>
                </select>
              </div>
              
              <div class="form-group">
                <label>Modelo *</label>
                <input 
                  type="text" 
                  [(ngModel)]="carForm.model" 
                  name="model" 
                  required 
                  class="form-input"
                  placeholder="Ej: Corolla">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>A√±o *</label>
                <select [(ngModel)]="carForm.year" name="year" required class="form-input">
                  <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                </select>
              </div>
              
              <div class="form-group">
                <label>N√∫mero de Placa *</label>
                <input 
                  type="text" 
                  [(ngModel)]="carForm.licensePlate" 
                  name="licensePlate" 
                  required 
                  class="form-input"
                  placeholder="Ej: ABC-123">
              </div>
            </div>
            
            <div class="form-group">
              <label>Color *</label>
              <input 
                type="text" 
                [(ngModel)]="carForm.color" 
                name="color" 
                required 
                class="form-input"
                placeholder="Ej: Blanco">
            </div>
            
            <div class="form-group">
              <label>Foto del Carro</label>
              <div class="file-upload">
                <input 
                  type="file" 
                  (change)="onFileSelected($event)"
                  accept="image/*"
                  class="file-input"
                  id="carPhoto">
                <label for="carPhoto" class="file-label">
                  üì∑ Seleccionar Foto
                </label>
                <div class="file-preview" *ngIf="previewUrl">
                  <img [src]="previewUrl" alt="Preview" class="preview-image">
                </div>
              </div>
            </div>
          </form>
        </div>
        
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelForm()">
            Cancelar
          </button>
          <button 
            class="btn btn-primary" 
            (click)="saveCar()"
            [disabled]="isLoading">
            {{ isLoading ? 'Guardando...' : (editingCar ? 'Actualizar' : 'Crear') }}
          </button>
        </div>
      </div>
    </div>
  </main>
</div>
